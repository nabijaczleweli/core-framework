"use strict";function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);e.length>t;t++)r[t]=e[t];return r}return Array.from(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;t.length>r;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),preloader=function(){function e(t){_classCallCheck(this,e),this.onComplete=t,this.config={cache:!0,parallel:!0},this.time={start:0,end:0},this.total=0,this.images=[],this._queue=[];for(var r=arguments.length,n=Array(r>1?r-1:0),a=1;r>a;a++)n[a-1]=arguments[a];t&&n&&(this.enqueue.apply(this,n),this.preload())}return _createClass(e,null,[{key:"getTimestamp",value:function(){return(window.performance.now||window.performance.webkitNow||Date.now).call(window.performance)}}]),_createClass(e,[{key:"enqueue",value:function(){for(var e=arguments.length,t=Array(e),r=0;e>r;r++)t[r]=arguments[r];return this._queue=this._queue.concat(t.map(function(e){return"string"==typeof e?{source:e}:e})),this}},{key:"_finish",value:function(e,t){--this.total,this.images.forEach(function(r){r.index==e&&(r.size={width:t.width,height:t.heigth})}),this.total||(this.time.end=(new Date).getTime(),this.onComplete({time:Math.round(this.time.end-this.time.start),images:this.images}))}},{key:"preload",value:function(t){var r=this;this.onComplete=t||this.onComplete,this.time.start=e.getTimestamp(),this.total=this._queue.length;for(var n=function(t){var n=new Image;r.images.push({index:t,image:n,size:{width:0,height:0}}),n.onload=n.onerror=n.onabort=function(){return r._finish(t,n)},n.src=r._queue[t].source+(r.config.cache?"":"?__preloader_cache_invalidator="+e.getTimestamp())},a=this.total;--a;)n(a)}},{key:"preloadCSSImages",value:function(e){this.enqueue.apply(this,_toConsumableArray(this.getCSSImages())).preload(e)}},{key:"_getCSSRules",value:function(){var e=[],t=function t(t){t.forEach(function(t){e.push({rule:t,selectorText:t.selectorText||null,declaration:t.cssText||t.style.cssText}),r(t.styleSheet||{})})},r=function r(e){return t(e.rules||e.cssRules||[])};return document.forEach(function(e){r(e.rules||e.cssRules),(e.imports||[]).forEach(r)}),e}},{key:"_getCSSImages",value:function(){return this._getCSSRules().reduce(function(e,t){return e.concat(t.declaration.match(/[^(|'"]+.(jpg|jpeg|gif|png|apng|bmp)\)?/gi))})}}]),e}();exports["default"]=preloader,module.exports=exports["default"];